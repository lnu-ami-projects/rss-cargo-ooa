# Monitoring & Alerting Model for RSS Cargo

## 1. Monitoring Model

### Таблиця операційних метрик

| Метрика                            | Виміри                        | Джерело даних                | Зв’язок з інфраструктурними ресурсами | Призначення                                         |
| ---------------------------------- | ----------------------------- | ---------------------------- | ------------------------------------- | --------------------------------------------------- |
| Завантаження CPU                   | Час (хвилина, година), сервер | Системний моніторинг сервера | Сервер додатка                        | Аналіз продуктивності серверів та навантаження      |
| Завантаження пам’яті               | Час (хвилина, година), сервер | Системний моніторинг сервера | Сервер додатка                        | Оцінка використання оперативної пам’яті             |
| Завантаження дискового простору    | Час (день, тиждень), сервер   | Моніторинг файлової системи  | Сервер додатка                        | Перевірка доступного місця для бази даних та файлів |
| Кількість активних сесій           | Час (хвилина, година)         | Таблиця логів додатка        | Сервер додатка                        | Моніторинг активності користувачів                  |
| Кількість запитів до бази даних    | Час (секунда, хвилина)        | Логи бази даних              | PostgreSQL сервер                     | Аналіз навантаження на базу даних                   |
| Середній час відповіді API         | Час (хвилина), маршрут API    | Логи веб-сервера             | Сервер додатка                        | Оцінка швидкості роботи сервісу                     |
| Помилки API                        | Час (хвилина, година), код    | Логи веб-сервера             | Сервер додатка                        | Моніторинг стабільності API                         |
| Час відповіді бази даних           | Час (хвилина), запит          | Логи PostgreSQL              | PostgreSQL сервер                     | Перевірка швидкості виконання запитів               |
| Кількість вхідних запитів HTTP     | Час (хвилина, година)         | Логи веб-сервера             | Сервер додатка                        | Аналіз трафіку                                      |
| Кількість HTTP-запитів 500         | Час (хвилина, година)         | Логи веб-сервера             | Сервер додатка                        | Моніторинг критичних помилок                        |
| Завантаження Docker-контейнерів    | Час (хвилина), контейнер      | Docker Monitoring            | Контейнери додатка та бази даних      | Моніторинг продуктивності контейнерів               |
| Температура CPU                    | Час (хвилина, година)         | Системний моніторинг         | Сервер додатка                        | Перевірка фізичного стану серверів                  |
| Середня пропускна здатність мережі | Час (хвилина, година)         | Моніторинг мережі            | Сервери додатка та бази даних         | Аналіз роботи мережі                                |
| Пропущені події у логах            | Час (день), джерело           | Логи додатка та бази даних   | Лог-файли                             | Перевірка коректності збору логів                   |
| Успішні резервні копії             | Час (день, тиждень)           | Логи резервного копіювання   | Сервер додатка                        | Моніторинг ефективності резервного копіювання       |

### Як будуть збиратися метрики

1. **Системний моніторинг**:
   - Використання інструментів типу `Prometheus`, `Grafana`, або `New Relic` для збору метрик сервера.
2. **Логи додатка та бази даних**:
   - Логи обробляються через сервіси типу `ELK Stack` або `Fluentd`.
3. **Моніторинг Docker-контейнерів**:
   - Використання вбудованих інструментів Docker, таких як `docker stats`.
4. **Мережевий моніторинг**:
   - Збір метрик через `Nagios` або подібних інструментів.

---

## 2. Alerting Model

### Таблиця допустимих значень та планів дій

| Метрика                         | Мін/Макс значення | Тип сповіщення         | Критичність | План дій (Mitigation Plan)                                      |
| ------------------------------- | ----------------- | ---------------------- | ----------- | --------------------------------------------------------------- |
| Завантаження CPU                | > 85%             | Email, Slack Alert     | Висока      | Перевірити активні процеси, масштабувати сервери                |
| Завантаження пам’яті            | > 80%             | Email                  | Середня     | Оптимізувати додаток, перевірити витоки пам’яті                 |
| Завантаження дискового простору | < 10%             | Email, SMS             | Висока      | Збільшити обсяг диску або очистити непотрібні файли             |
| Час відповіді API               | > 500 мс          | Slack Alert            | Висока      | Перевірити логіку API, оптимізувати запити до бази даних        |
| Помилки API                     | > 5%              | Slack Alert, PagerDuty | Критична    | Відстежити помилки в логах, виправити критичні помилки          |
| Час відповіді бази даних        | > 200 мс          | Email                  | Середня     | Оптимізувати запити, перевірити індекси в базі                  |
| Кількість HTTP-запитів 500      | > 10 за хвилину   | PagerDuty              | Критична    | Ідентифікувати причину помилок у логах, виправити код           |
| Завантаження Docker-контейнерів | > 80%             | Email                  | Середня     | Перевірити процеси в контейнері, перезапустити контейнер        |
| Пропускна здатність мережі      | < 50 Мбіт/с       | Email                  | Середня     | Перевірити підключення до мережі, додати резервні ресурси       |
| Успішні резервні копії          | < 95%             | Email                  | Низька      | Перевірити процес резервного копіювання, виправити налаштування |

### Деталізований план дій (Mitigation Plan) для критичних метрик

1. **Завантаження CPU > 85%**
   - **Дії**: Визначити активні процеси на сервері, перевірити можливі нескінченні цикли або інші ресурсоємні операції. Якщо проблема не вирішена, додати додаткові обчислювальні ресурси (масштабування горизонтальне або вертикальне).
2. **Помилки API > 5%**

   - **Дії**: Перевірити логіку API, ідентифікувати маршрути з найбільшою кількістю помилок. Виправити проблемні частини коду або оновити залежності.

3. **Час відповіді API > 500 мс**

   - **Дії**: Оптимізувати SQL-запити, перевірити кешування, впровадити додатковий рівень балансування навантаження.

4. **Кількість HTTP-запитів 500 > 10/хв**

   - **Дії**: Перевірити стан веб-сервера, перевірити останні зміни в коді додатка. У разі необхідності повернутися до стабільної версії коду.

5. **Завантаження дискового простору < 10%**
   - **Дії**: Негайно очистити тимчасові файли або логи, збільшити обсяг диску, якщо потрібно.

---

## Висновок

Модель моніторингу та оповіщень забезпечує постійний контроль за роботою системи та своєчасне реагування на потенційні проблеми. Це дозволяє мінімізувати ризики збоїв та підвищити стабільність роботи системи.
